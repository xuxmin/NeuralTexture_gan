
## Neural Texture

徐贤民 2020年11月30日

### 实现细节

整体流程为输入 uv map , 光源的方向 light dir, 视角方向 view_dir, 法线贴图，模型生成该光照条件下的图片:
1. 输入 uv map
2. 采样 neural texture(16 × 256 × 256，无 hierarchy) 获得特征， 大小为 16 × H × W
3. 前 3 层与 normal 相乘, 3-6 层与 view_dir 相乘, 6-9 层与 light_dir 相乘, 获得变换后的特征
4. 将变换后的特征输入生成模型生成最终的图片

数据预处理:
- 数据使用 $\frac{\log(e^{-3}+x)}{\log(e^3)}$ 变换到 $[-1, 1]$ 之间, 没有做 data augment

训练细节:
- 使用 conditional GAN(pix2pixhd) 的方式训练, 除了 L1 loss 之外, 增加 GAN loss, 特征匹配损失, VGG loss
- 判别器使用 SGD+动量训练，生成器使用 Adam 训练
- batch size=1

### 结果

exp1 使用 28 个方向，每个方向 48(1/8) 种光照进行训练, 一共 1344 张图片

exp2 使用 28 个方向，每个方向 7/8 种光照进行训练。

exp1 与 exp2 均使用剩余 1/8 的方向与剩余 1/8 的光照进行测试, 一共 2880 张图片。最终结果
- exp1: MAE=0.0161 MSE=0.0028
- exp2: MAE=0.0129 MSE=0.0021

对比

[![1.png](http://182.92.112.211:8080/images/2020/11/30/1.png)](http://182.92.112.211:8080/image/uFsQ)
[![2.png](http://182.92.112.211:8080/images/2020/11/30/2.png)](http://182.92.112.211:8080/image/uD4J)
[![3.png](http://182.92.112.211:8080/images/2020/11/30/3.png)](http://182.92.112.211:8080/image/u15X)
[![4.png](http://182.92.112.211:8080/images/2020/11/30/4.png)](http://182.92.112.211:8080/image/uJCD)
[![5.png](http://182.92.112.211:8080/images/2020/11/30/5.png)](http://182.92.112.211:8080/image/uLeM)
[![6.png](http://182.92.112.211:8080/images/2020/11/30/6.png)](http://182.92.112.211:8080/image/uq2s)
[![7.png](http://182.92.112.211:8080/images/2020/11/30/7.png)](http://182.92.112.211:8080/image/u3rU)
[![8.png](http://182.92.112.211:8080/images/2020/11/30/8.png)](http://182.92.112.211:8080/image/uAh5)

**光照连续变化的情况下的效果视频**

http://182.92.112.211:7070/s/W6GkgKWM7kXHbcE

左边 exp1, 右边 exp2, 过拟合??

